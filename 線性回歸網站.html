<html><head><base href="https://websim.ai/linear-regression-demo-tw/"><title>線性回歸演示</title>
<script src="https://cdn.jsdelivr.net/pyodide/v0.22.1/full/pyodide.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { padding: 20px; }
  #plot { width: 100%; height: 600px; }
  .sidebar { background-color: #f8f9fa; padding: 20px; border-radius: 10px; }
</style>
</head>
<body>
<div class="container-fluid">
  <h1 class="text-center mb-4">線性回歸演示</h1>
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar">
        <h4>參數調整</h4>
        <div class="mb-3">
          <label for="a_slider" class="form-label">斜率 (a): <span id="a_value"></span></label>
          <input type="range" class="form-range" id="a_slider" min="-50" max="50" step="0.1" value="1">
        </div>
        <div class="mb-3">
          <label for="n_slider" class="form-label">點的數量 (n): <span id="n_value"></span></label>
          <input type="range" class="form-range" id="n_slider" min="100" max="1000" step="10" value="500">
        </div>
        <div class="mb-3">
          <label for="c_slider" class="form-label">噪聲係數 (c): <span id="c_value"></span></label>
          <input type="range" class="form-range" id="c_slider" min="10" max="100" step="1" value="50">
        </div>
        <button id="generate" class="btn btn-primary w-100">生成數據</button>
      </div>
    </div>
    <div class="col-md-9">
      <div id="plot"></div>
    </div>
  </div>
</div>

<script>
async function main() {
  let pyodide = await loadPyodide();
  await pyodide.loadPackage("numpy");
  await pyodide.loadPackage("scikit-learn");

  const generateData = () => {
    const a = parseFloat(document.getElementById('a_slider').value);
    const n = parseInt(document.getElementById('n_slider').value);
    const c = parseFloat(document.getElementById('c_slider').value);

    document.getElementById('a_value').textContent = a;
    document.getElementById('n_value').textContent = n;
    document.getElementById('c_value').textContent = c;

    pyodide.runPython(`
import numpy as np
from sklearn.linear_model import LinearRegression

# 生成數據
n = ${n}
x = np.random.uniform(-10, 10, n)
y = ${a} * x + 5 + ${c} * np.random.normal(0, 1, n)

# 擬合線性回歸
model = LinearRegression()
model.fit(x.reshape(-1, 1), y)

# 生成回歸線的點
x_line = np.array([-10, 10])
y_line = model.predict(x_line.reshape(-1, 1))

# 準備繪圖數據
data = [
    {
        'x': x.tolist(),
        'y': y.tolist(),
        'mode': 'markers',
        'type': 'scatter',
        'name': '數據點',
        'marker': {'symbol': 'star', 'size': 8}
    },
    {
        'x': x_line.tolist(),
        'y': y_line.tolist(),
        'mode': 'lines',
        'type': 'scatter',
        'name': '回歸線',
        'line': {'color': 'red', 'width': 3}
    }
]

layout = {
    'title': '線性回歸',
    'xaxis': {'title': 'X'},
    'yaxis': {'title': 'Y'},
    'font': {'size': 14},
    'showlegend': True
}

import json
plot_data = json.dumps({'data': data, 'layout': layout})
    `);

    const plotData = JSON.parse(pyodide.globals.get('plot_data'));
    Plotly.newPlot('plot', plotData.data, plotData.layout);
  };

  document.getElementById('generate').addEventListener('click', generateData);
  document.getElementById('a_slider').addEventListener('input', generateData);
  document.getElementById('n_slider').addEventListener('input', generateData);
  document.getElementById('c_slider').addEventListener('input', generateData);

  generateData();
}

main();
</script>
</body></html>